# LISA AI - Render Deployment Guide

This guide will help you deploy the LISA AI application to Render with PostgreSQL database, backend API, and frontend.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **OpenAI API Key**: Get your API key from [OpenAI](https://platform.openai.com/api-keys)
4. **Assistant ID**: Create an OpenAI Assistant and get its ID

## Deployment Steps

### 1. Prepare Your Repository

Ensure all files are committed and pushed to your GitHub repository:
```bash
git add .
git commit -m "Prepare for Render deployment"
git push origin main
```

### 2. Deploy Using render.yaml (Recommended)

1. **Connect Repository to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing your LISA AI code

2. **Render will automatically detect the `render.yaml` file and create**:
   - PostgreSQL Database (`lisa-database`)
   - Backend API Service (`lisa-backend`)
   - Frontend Static Site (`lisa-frontend`)

### 3. Configure Environment Variables

After deployment starts, you'll need to configure these environment variables in the Render dashboard:

#### Backend Service Environment Variables:
- `OPENAI_API_KEY`: Your OpenAI API key
- `ASSISTANT_ID`: Your OpenAI Assistant ID
- `EMAIL_HOST`: (Optional) SMTP host if using email features
- `EMAIL_PORT`: (Optional) SMTP port
- `EMAIL_USER`: (Optional) Email username
- `EMAIL_PASS`: (Optional) Email password
- `ADMIN_EMAIL`: (Optional) Admin email address

**Note**: `JWT_SECRET`, `SESSION_SECRET`, and `POSTGRES_PASSWORD` are automatically generated by Render.

### 4. Manual Deployment (Alternative)

If you prefer manual deployment, follow these steps:

#### Step 4.1: Create PostgreSQL Database
1. In Render Dashboard, click "New" → "PostgreSQL"
2. Name: `lisa-database`
3. Database Name: `lisa_db`
4. User: `lisa_user`
5. Select "Free" plan
6. Click "Create Database"

#### Step 4.2: Deploy Backend API
1. Click "New" → "Web Service"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `lisa-backend`
   - **Environment**: `Node`
   - **Build Command**: `cd server/chatbot-backend && npm install`
   - **Start Command**: `cd server/chatbot-backend && npm start`
   - **Health Check Path**: `/api/health`
4. Add environment variables (see section 3 above)
5. Click "Create Web Service"

#### Step 4.3: Deploy Frontend
1. Click "New" → "Static Site"
2. Connect your GitHub repository
3. Configure:
   - **Name**: `lisa-frontend`
   - **Build Command**: `cd client/chatbot-frontend-2 && npm install && npm run build`
   - **Publish Directory**: `client/chatbot-frontend-2/build`
4. Add environment variables:
   - `REACT_APP_API_URL`: `https://lisa-backend.onrender.com`
   - `REACT_APP_ENVIRONMENT`: `production`
5. Click "Create Static Site"

## Post-Deployment Configuration

### 1. Update CORS Settings
After both services are deployed, update the backend environment variables:
- `FRONTEND_URL`: Your frontend URL (e.g., `https://lisa-frontend.onrender.com`)
- `CORS_ORIGIN`: Same as FRONTEND_URL

### 2. Database Initialization
The database will be automatically initialized when the backend starts (thanks to the `postinstall` script).

### 3. Create Admin User
To create your first admin user, you can use the admin creation endpoint or create one through the registration process and then manually update the database.

## Service URLs

After deployment, your services will be available at:
- **Frontend**: `https://lisa-frontend.onrender.com`
- **Backend API**: `https://lisa-backend.onrender.com`
- **Database**: Internal connection string (automatically configured)

## Environment Variables Reference

### Backend Required Variables:
```env
# Auto-configured by Render
DATABASE_URL=postgresql://...
JWT_SECRET=auto-generated
SESSION_SECRET=auto-generated
PORT=10000
NODE_ENV=production

# You must configure these:
OPENAI_API_KEY=your_openai_api_key
ASSISTANT_ID=your_assistant_id

# Auto-configured (update after frontend deployment)
FRONTEND_URL=https://lisa-frontend.onrender.com
CORS_ORIGIN=https://lisa-frontend.onrender.com
```

### Frontend Variables:
```env
REACT_APP_API_URL=https://lisa-backend.onrender.com
REACT_APP_ENVIRONMENT=production
```

## Troubleshooting

### Common Issues:

1. **Build Failures**:
   - Check build logs in Render dashboard
   - Ensure all dependencies are in package.json
   - Verify build commands are correct

2. **Database Connection Issues**:
   - Ensure DATABASE_URL is properly configured
   - Check database service is running
   - Verify SSL settings in production

3. **CORS Errors**:
   - Update FRONTEND_URL and CORS_ORIGIN after frontend deployment
   - Ensure frontend URL matches exactly

4. **Environment Variables**:
   - Double-check all required variables are set
   - Ensure OPENAI_API_KEY and ASSISTANT_ID are correct

### Monitoring:
- Use Render dashboard to monitor service health
- Check logs for any runtime errors
- Monitor database performance and usage

## Scaling Considerations

For production use, consider upgrading from free tier:
- **Database**: Upgrade for more storage and better performance
- **Backend**: Upgrade for more resources and faster response times
- **Frontend**: Free tier is usually sufficient for static sites

## Security Notes

1. All sensitive data is encrypted in transit and at rest
2. Environment variables are securely managed by Render
3. Database access is restricted to your services
4. HTTPS is automatically enabled for all services

## Support

If you encounter issues:
1. Check Render documentation: [render.com/docs](https://render.com/docs)
2. Review application logs in Render dashboard
3. Ensure all environment variables are correctly configured

---

**Congratulations!** Your LISA AI application should now be successfully deployed on Render with PostgreSQL database, backend API, and frontend. 